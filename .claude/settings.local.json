{
  "permissions": {
    "allow": [
      "Bash(cat:*)",
      "Bash(npm run build:*)",
      "Bash(ls:*)",
      "Bash(npm run dev:*)",
      "Bash(npx tsc:*)",
      "Bash(npm install:*)",
      "Bash(supabase --version:*)",
      "Bash(supabase db push:*)",
      "Bash(supabase projects:*)",
      "Bash(supabase link:*)",
      "Bash(supabase db execute:*)",
      "Bash(security find-generic-password:*)",
      "Bash(curl:*)",
      "Bash(PGPASSWORD=\"Locagame12345@\" psql:*)",
      "mcp__plugin_supabase_supabase__list_projects",
      "mcp__plugin_supabase_supabase__list_tables",
      "mcp__plugin_supabase_supabase__list_migrations",
      "mcp__plugin_supabase_supabase__get_advisors",
      "mcp__plugin_supabase_supabase__execute_sql",
      "mcp__plugin_supabase_supabase__apply_migration",
      "mcp__plugin_supabase_supabase__deploy_edge_function",
      "mcp__plugin_supabase_supabase__list_edge_functions",
      "Bash(timeout:*)",
      "Bash(netstat:*)",
      "Bash(tasklist:*)",
      "Bash(taskkill:*)",
      "mcp__plugin_supabase_supabase__get_logs",
      "Bash(python:*)",
      "mcp__plugin_supabase_supabase__get_publishable_keys",
      "Bash(git checkout:*)",
      "Bash(SUPABASE_URL=\"https://koqdpkkuarbjiimkopei.supabase.co\")",
      "Bash(SERVICE_KEY=\"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtvcWRwa2t1YXJiamlpbWtvcGVpIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2MjgzNDU5NSwiZXhwIjoyMDc4NDEwNTk1fQ.-0yVHfgtDIV_Gkjx8OJQRUT9dj9mfpwZoaUDWeNWpvE\")",
      "Bash(node -e \"\nconst { Client } = require\\(''pg''\\);\n\nconst client = new Client\\({\n  host: ''db.koqdpkkuarbjiimkopei.supabase.co'',\n  port: 5432,\n  database: ''postgres'',\n  user: ''postgres'',\n  password: ''Locagame12345@'',\n  ssl: { rejectUnauthorized: false }\n}\\);\n\nasync function run\\(\\) {\n  await client.connect\\(\\);\n  console.log\\(''Connected successfully!''\\);\n  \n  // Query 1\n  console.log\\(''\\\\n=== QUERY 1: Row counts in key tables ===''\\);\n  const q1 = await client.query\\(\\\\`\n    SELECT ''products'' as tbl, count\\(*\\) as cnt FROM products\n    UNION ALL SELECT ''products_active'', count\\(*\\) FROM products WHERE is_active = true\n    UNION ALL SELECT ''categories'', count\\(*\\) FROM categories\n    UNION ALL SELECT ''testimonials'', count\\(*\\) FROM testimonials\n    UNION ALL SELECT ''testimonials_featured'', count\\(*\\) FROM testimonials WHERE is_active = true AND is_featured = true\n  \\\\`\\);\n  console.table\\(q1.rows\\);\n  \n  // Query 2\n  console.log\\(''\\\\n=== QUERY 2: RLS status on all public tables ===''\\);\n  const q2 = await client.query\\(\\\\`\n    SELECT tablename, rowsecurity FROM pg_tables WHERE schemaname=''public'' ORDER BY tablename\n  \\\\`\\);\n  console.table\\(q2.rows\\);\n  \n  // Query 3\n  console.log\\(''\\\\n=== QUERY 3: All RLS policies ===''\\);\n  const q3 = await client.query\\(\\\\`\n    SELECT tablename, policyname, roles, cmd, qual FROM pg_policies WHERE schemaname=''public'' ORDER BY tablename, policyname\n  \\\\`\\);\n  if \\(q3.rows.length === 0\\) {\n    console.log\\(''No RLS policies found.''\\);\n  } else {\n    console.table\\(q3.rows\\);\n  }\n  \n  // Query 4\n  console.log\\(''\\\\n=== QUERY 4: Auth users ===''\\);\n  const q4 = await client.query\\(\\\\`\n    SELECT id, email, created_at, last_sign_in_at, confirmed_at FROM auth.users ORDER BY created_at\n  \\\\`\\);\n  if \\(q4.rows.length === 0\\) {\n    console.log\\(''No auth users found.''\\);\n  } else {\n    q4.rows.forEach\\(r => {\n      console.log\\(JSON.stringify\\({\n        id: r.id,\n        email: r.email,\n        created_at: r.created_at,\n        last_sign_in_at: r.last_sign_in_at,\n        confirmed_at: r.confirmed_at\n      }\\)\\);\n    }\\);\n  }\n  \n  // Query 5\n  console.log\\(''\\\\n=== QUERY 5: admin_users table ===''\\);\n  try {\n    const q5 = await client.query\\(''SELECT * FROM admin_users''\\);\n    if \\(q5.rows.length === 0\\) {\n      console.log\\(''admin_users table exists but is empty.''\\);\n    } else {\n      console.table\\(q5.rows\\);\n    }\n  } catch\\(e\\) {\n    console.log\\(''Error: '' + e.message\\);\n  }\n  \n  // Query 6\n  console.log\\(''\\\\n=== QUERY 6: get_current_user_role RPC function ===''\\);\n  const q6 = await client.query\\(\\\\`\n    SELECT routine_name, routine_type FROM information_schema.routines \n    WHERE routine_schema = ''public'' AND routine_name = ''get_current_user_role''\n  \\\\`\\);\n  if \\(q6.rows.length === 0\\) {\n    console.log\\(''Function get_current_user_role does NOT exist.''\\);\n  } else {\n    console.table\\(q6.rows\\);\n  }\n  \n  await client.end\\(\\);\n}\n\nrun\\(\\).catch\\(e => { console.error\\(''Connection error:'', e.message\\); process.exit\\(1\\); }\\);\n\")",
      "Bash(npm uninstall:*)",
      "Bash(npx vite build)",
      "Bash(git add:*)",
      "Bash(git commit:*)",
      "Bash(git push:*)",
      "Bash(node -e \"\nconst { Client } = require\\(''pg''\\);\nconst client = new Client\\({\n  host: ''db.koqdpkkuarbjiimkopei.supabase.co'',\n  port: 5432,\n  database: ''postgres'',\n  user: ''postgres'',\n  password: ''Locagame12345@'',\n  ssl: { rejectUnauthorized: false }\n}\\);\nasync function run\\(\\) {\n  await client.connect\\(\\);\n  console.log\\(''Connected to Supabase DB''\\);\n  const r = await client.query\\(\"\"SELECT policyname, cmd, roles FROM pg_policies WHERE tablename IN \\(''products'',''categories''\\) ORDER BY tablename, policyname\"\"\\);\n  console.table\\(r.rows\\);\n  await client.end\\(\\);\n}\nrun\\(\\).catch\\(e => { console.error\\(e.message\\); process.exit\\(1\\); }\\);\n\")",
      "Bash(node -e \"\nconst { Client } = require\\(''pg''\\);\nconst client = new Client\\({\n  host: ''db.koqdpkkuarbjiimkopei.supabase.co'',\n  port: 5432,\n  database: ''postgres'',\n  user: ''postgres'',\n  password: ''Locagame12345@'',\n  ssl: { rejectUnauthorized: false }\n}\\);\nasync function run\\(\\) {\n  await client.connect\\(\\);\n  console.log\\(''Connected to Supabase DB''\\);\n  const r = await client.query\\(\"\"SELECT tablename, policyname, cmd, roles FROM pg_policies WHERE tablename IN \\(''products'',''categories''\\) ORDER BY tablename, policyname\"\"\\);\n  console.table\\(r.rows\\);\n  await client.end\\(\\);\n}\nrun\\(\\).catch\\(e => { console.error\\(e.message\\); process.exit\\(1\\); }\\);\n\")",
      "Bash(node -e \"\nconst { Client } = require\\(''pg''\\);\nconst client = new Client\\({\n  host: ''db.koqdpkkuarbjiimkopei.supabase.co'',\n  port: 5432,\n  database: ''postgres'',\n  user: ''postgres'',\n  password: ''Locagame12345@'',\n  ssl: { rejectUnauthorized: false }\n}\\);\nasync function run\\(\\) {\n  await client.connect\\(\\);\n  // Check policy definitions\n  const r = await client.query\\(\"\"SELECT tablename, policyname, cmd, qual, with_check FROM pg_policies WHERE tablename IN \\(''products'',''categories''\\) ORDER BY tablename, policyname\"\"\\);\n  for \\(const row of r.rows\\) {\n    console.log\\(''---''\\);\n    console.log\\(''Table:'', row.tablename, ''| Policy:'', row.policyname, ''| CMD:'', row.cmd\\);\n    console.log\\(''USING:'', row.qual\\);\n    console.log\\(''WITH CHECK:'', row.with_check\\);\n  }\n\n  // Check unique constraints on products\n  console.log\\(''\\\\n=== UNIQUE constraints on products ===''\\);\n  const u = await client.query\\(\"\"SELECT conname, contype, pg_get_constraintdef\\(oid\\) as definition FROM pg_constraint WHERE conrelid = ''public.products''::regclass ORDER BY conname\"\"\\);\n  console.table\\(u.rows\\);\n\n  // Check admin_users count\n  const a = await client.query\\(''SELECT count\\(*\\) as cnt FROM admin_users WHERE is_active = true''\\);\n  console.log\\(''\\\\nActive admins:'', a.rows[0].cnt\\);\n\n  // Check product count\n  const p = await client.query\\(''SELECT count\\(*\\) as total, count\\(*\\) FILTER \\(WHERE is_active\\) as active FROM products''\\);\n  console.log\\(''Products:'', p.rows[0]\\);\n\n  // Check categories\n  const c = await client.query\\(''SELECT id, slug, name FROM categories ORDER BY display_order''\\);\n  console.table\\(c.rows\\);\n\n  await client.end\\(\\);\n}\nrun\\(\\).catch\\(e => { console.error\\(e.message\\); process.exit\\(1\\); }\\);\n\")",
      "Bash(node -e \"\nconst { Client } = require\\(''pg''\\);\nconst fs = require\\(''fs''\\);\n\nconst client = new Client\\({\n  host: ''db.koqdpkkuarbjiimkopei.supabase.co'',\n  port: 5432,\n  database: ''postgres'',\n  user: ''postgres'',\n  password: ''Locagame12345@'',\n  ssl: { rejectUnauthorized: false }\n}\\);\n\nasync function run\\(\\) {\n  await client.connect\\(\\);\n  console.log\\(''Connected to Supabase DB''\\);\n\n  // Read and execute migration\n  const sql = fs.readFileSync\\(''supabase/migrations/20260216_add_products_categories_admin_rls.sql'', ''utf8''\\);\n  console.log\\(''Executing migration...''\\);\n  await client.query\\(sql\\);\n  console.log\\(''Migration applied successfully!''\\);\n\n  // Verify\n  console.log\\(''\\\\n=== Verification: categories policies ===''\\);\n  const r = await client.query\\(\"\"SELECT policyname, cmd, roles FROM pg_policies WHERE tablename = ''categories'' ORDER BY policyname\"\"\\);\n  console.table\\(r.rows\\);\n\n  await client.end\\(\\);\n}\nrun\\(\\).catch\\(e => { console.error\\(''Error:'', e.message\\); process.exit\\(1\\); }\\);\n\")",
      "Bash(node -e \"\nconst { Client } = require\\(''pg''\\);\nconst client = new Client\\({\n  host: ''db.koqdpkkuarbjiimkopei.supabase.co'',\n  port: 5432,\n  database: ''postgres'',\n  user: ''postgres'',\n  password: ''Locagame12345@'',\n  ssl: { rejectUnauthorized: false }\n}\\);\n\nasync function run\\(\\) {\n  await client.connect\\(\\);\n\n  // Test: verify upsert on products will work with ON CONFLICT \\(slug\\)\n  console.log\\(''=== Test upsert syntax on products ===''\\);\n\n  // Test 1: Check a sample product\n  const sample = await client.query\\(\"\"SELECT id, name, slug, pricing, total_stock, category_id FROM products LIMIT 2\"\"\\);\n  console.log\\(''Sample products:''\\);\n  for \\(const row of sample.rows\\) {\n    console.log\\(JSON.stringify\\({\n      id: row.id,\n      name: row.name,\n      slug: row.slug,\n      pricing: row.pricing,\n      total_stock: row.total_stock,\n      category_id: row.category_id\n    }\\)\\);\n  }\n\n  // Test 2: Verify the upsert SQL works \\(dry run with ROLLBACK\\)\n  await client.query\\(''BEGIN''\\);\n  try {\n    const upsertResult = await client.query\\(\n      \"\"INSERT INTO products \\(name, slug, category_id, description, pricing, total_stock, is_active\\) VALUES \\($1, $2, $3, $4, $5::jsonb, $6, $7\\) ON CONFLICT \\(slug\\) DO UPDATE SET name = EXCLUDED.name, category_id = EXCLUDED.category_id, description = EXCLUDED.description, pricing = EXCLUDED.pricing, total_stock = EXCLUDED.total_stock RETURNING id, name, slug\"\",\n      [''Test Import Product'', ''test-import-product'', ''1bb90403-eb72-4c55-ada7-1c8da3625df6'', ''Test description'', JSON.stringify\\({oneDay: 100, weekend: 200, week: 500}\\), 5, true]\n    \\);\n    console.log\\(''\\\\nUpsert test successful:'', upsertResult.rows[0]\\);\n  } finally {\n    await client.query\\(''ROLLBACK''\\);\n    console.log\\(''ROLLBACK: no actual data changed''\\);\n  }\n\n  await client.end\\(\\);\n}\nrun\\(\\).catch\\(e => { console.error\\(''Error:'', e.message\\); process.exit\\(1\\); }\\);\n\")",
      "Bash(node -e \"\nconst { createClient } = require\\(''@supabase/supabase-js''\\);\n\nconst supabase = createClient\\(\n  ''https://koqdpkkuarbjiimkopei.supabase.co'',\n  ''eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtvcWRwa2t1YXJiamlpbWtvcGVpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI4MzQ1OTUsImV4cCI6MjA3ODQxMDU5NX0.P6oyNyvVCXFZhwSlewEKkgpg4lMUUe7Tq1DiyPNbXXw''\n\\);\n\nasync function run\\(\\) {\n  // 1. Login as admin\n  console.log\\(''1. Login as admin@locagame.fr...''\\);\n  const { data: authData, error: authError } = await supabase.auth.signInWithPassword\\({\n    email: ''admin@locagame.fr'',\n    password: ''Admin123!''\n  }\\);\n  if \\(authError\\) {\n    console.error\\(''Auth error:'', authError.message\\);\n    return;\n  }\n  console.log\\(''   Logged in as:'', authData.user.email\\);\n\n  // 2. Fetch categories map\n  console.log\\(''2. Fetch categories \\(for slug->id mapping\\)...''\\);\n  const { data: cats, error: catsError } = await supabase.from\\(''categories''\\).select\\(''id, slug''\\);\n  if \\(catsError\\) {\n    console.error\\(''Categories error:'', catsError.message\\);\n    return;\n  }\n  console.log\\(''   Categories:'', cats.length\\);\n  const catMap = {};\n  for \\(const c of cats\\) catMap[c.slug] = c.id;\n\n  // 3. Test upsert with a test product\n  console.log\\(''3. Test upsert \\(INSERT new test product\\)...''\\);\n  const testProduct = {\n    name: ''TEST IMPORT EXCEL'',\n    slug: ''test-import-excel-verification'',\n    category_id: catMap[''casino-poker''],\n    description: ''Produit de test import Excel - a supprimer'',\n    pricing: { oneDay: 99, weekend: 149, week: 399, custom: 99 },\n    total_stock: 3,\n    is_active: false // inactif pour ne pas apparaitre en front\n  };\n\n  const { data: upsertData, error: upsertError } = await supabase\n    .from\\(''products''\\)\n    .upsert\\(testProduct, { onConflict: ''slug'' }\\)\n    .select\\(''id, name, slug, pricing, total_stock''\\);\n\n  if \\(upsertError\\) {\n    console.error\\(''   UPSERT ERROR:'', upsertError.message\\);\n    return;\n  }\n  console.log\\(''   Upsert success:'', JSON.stringify\\(upsertData[0]\\)\\);\n\n  // 4. Test upsert UPDATE \\(modify the same product\\)\n  console.log\\(''4. Test upsert \\(UPDATE same product, change price\\)...''\\);\n  testProduct.pricing.oneDay = 199;\n  testProduct.pricing.custom = 199;\n  testProduct.total_stock = 10;\n\n  const { data: updateData, error: updateError } = await supabase\n    .from\\(''products''\\)\n    .upsert\\(testProduct, { onConflict: ''slug'' }\\)\n    .select\\(''id, name, slug, pricing, total_stock''\\);\n\n  if \\(updateError\\) {\n    console.error\\(''   UPDATE ERROR:'', updateError.message\\);\n    return;\n  }\n  console.log\\(''   Update success:'', JSON.stringify\\(updateData[0]\\)\\);\n  console.log\\(''   Price changed: 99 -> 199, Stock: 3 -> 10''\\);\n\n  // 5. Cleanup: delete test product\n  console.log\\(''5. Cleanup: delete test product...''\\);\n  const { error: deleteError } = await supabase\n    .from\\(''products''\\)\n    .delete\\(\\)\n    .eq\\(''slug'', ''test-import-excel-verification''\\);\n\n  if \\(deleteError\\) {\n    console.error\\(''   DELETE ERROR:'', deleteError.message\\);\n  } else {\n    console.log\\(''   Deleted successfully''\\);\n  }\n\n  // 6. Test export query \\(getAllProductsForExport\\)\n  console.log\\(''6. Test export query...''\\);\n  const { data: exportData, error: exportError } = await supabase\n    .from\\(''products''\\)\n    .select\\(''name, slug, pricing, total_stock, description, category:categories\\(slug\\)''\\)\n    .order\\(''name'', { ascending: true }\\)\n    .limit\\(3\\);\n\n  if \\(exportError\\) {\n    console.error\\(''   EXPORT ERROR:'', exportError.message\\);\n    return;\n  }\n  console.log\\(''   Export sample \\(3 products\\):''\\);\n  for \\(const p of exportData\\) {\n    console.log\\(''   -'', p.name, ''| cat:'', p.category?.slug, ''| oneDay:'', p.pricing?.oneDay\\);\n  }\n\n  console.log\\(''\\\\n=== ALL TESTS PASSED ===''\\);\n}\n\nrun\\(\\).catch\\(e => console.error\\(''Fatal:'', e.message\\)\\);\n\")",
      "Bash(node -e \"\nconst { Client } = require\\(''pg''\\);\nconst client = new Client\\({\n  host: ''db.koqdpkkuarbjiimkopei.supabase.co'',\n  port: 5432,\n  database: ''postgres'',\n  user: ''postgres'',\n  password: ''Locagame12345@'',\n  ssl: { rejectUnauthorized: false }\n}\\);\nasync function run\\(\\) {\n  await client.connect\\(\\);\n  const r = await client.query\\(''SELECT id, email FROM auth.users ORDER BY created_at''\\);\n  console.table\\(r.rows\\);\n  await client.end\\(\\);\n}\nrun\\(\\).catch\\(e => console.error\\(e.message\\)\\);\n\")",
      "Bash(node -e:*)",
      "Bash(npx vite:*)",
      "Bash(for f in src/components/hero/constants.ts src/components/hero/DropdownPortal.tsx src/components/hero/HeroBackground.tsx src/components/hero/HeroSearchBar.tsx src/components/hero/HeroCategories.tsx src/components/hero/HeroStats.tsx src/components/hero/HeroTitle.tsx src/components/header/constants.ts src/components/header/DesktopTopBar.tsx src/components/header/DesktopNav.tsx src/components/header/MobileHeader.tsx src/components/header/MobileMenu.tsx src/components/catalog/CatalogHeroSearch.tsx src/components/catalog/CatalogProductGrid.tsx src/components/date-range-picker/CalendarGrid.tsx src/components/date-range-picker/DateSelectionSummary.tsx src/components/price-calculator/constants.ts src/components/price-calculator/DeliveryModeSelector.tsx src/components/price-calculator/DeliveryForm.tsx src/components/price-calculator/PriceSummary.tsx src/components/product-card/ProductCardImage.tsx src/components/product-card/ProductCardActions.tsx)",
      "Bash(do)",
      "Bash(if [ ! -f \"$f\" ])",
      "Bash(then echo \"MISSING: $f\")",
      "Bash(fi)",
      "Bash(done)",
      "Bash(grep:*)",
      "Bash(git status:*)",
      "mcp__plugin_supabase_supabase__get_project_url",
      "Bash(node scripts/generate-sitemap.js:*)",
      "Bash(find:*)"
    ]
  }
}
